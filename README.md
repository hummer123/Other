# 随便记一下

## KFIFO 
linux中的 **kfifo** 有意思的几点（linux-2.6.32.12）
- 缓冲区大小必须是2的幂，如2^2, 2^10，好处是在计算剩余可用空间是可以使用与运算来代替取模运算 (x % 4) == (x & (4 - 1))；
- 队列的头结点与尾结点的使用的是unsigned类型，结点数据使用溢出来自动纠正，这样在向队列中添加元素时直接使用头结点++，取数据时尾结点--。
- 在计算队列长度时直接使用头结点 - 尾结点，不用考虑头结点溢出时尾结点还未溢出清苦，如二字节无符号类型， -n = 2^16 - n，所以 7 - 65530 = 13。
- **注意**在往队列中放数据时kfifo采用对输入的数据，最大放入队列剩余空间的数据，即本次放入8字节数据，而队列只有4字节，则实际放入为4字节。所以如果队列中是以结构体放入是缓存大小区的不当时这里要以最小结构体放入，要么不放。
